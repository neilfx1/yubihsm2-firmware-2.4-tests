# PKCS1v15 Encryption/Decryption Test

This test demonstrates encrypting data using OpenSSL with PKCS1v15 padding and decrypting it using a private RSA key stored in the YubiHSM2.

---

### 1. Create a working directory

```bash
mkdir pkcstest && cd pkcstest
```

### 2. Create a plaintext file

Use your preferred text editor to create `testdata.txt` with some recognizable content.

### 3. Generate RSA 2048-bit private key

```bash
openssl genrsa -out priv.key 2048
```

### 4. Extract the public key

```bash
openssl rsa -pubout -in priv.key -out public.pem
```

### 5. Encrypt the plaintext using the public key (PKCS1v15 is default)

```bash
openssl pkeyutl -in testdata.txt -encrypt -pubin -inkey public.pem -out encrypted.pem
```

### 6. Import the private key into YubiHSM2

```bash
yubihsm> put asymmetric <session> 0 pkcs15test all all priv.key
```

Make note of the returned **Object ID** (e.g., `0x93a1`).

### 7. Decrypt with YubiHSM2

```bash
yubihsm> decrypt pkcs1v1_5 <session> <objectID> encrypted.pem
```

Depending on your OS, you may see:
- The unencrypted plaintext directly
- A base64-encoded output (in which case, continue below)

### 8. Decode base64 output (if needed)

```bash
openssl base64 -d
```

Paste the base64 string, press **Enter**, then press **Ctrl+D** to end input and view the decoded output.

---

✅ **Test Complete**  
You’ve now encrypted test data with PKCS1v15 and successfully decrypted it using YubiHSM2.
